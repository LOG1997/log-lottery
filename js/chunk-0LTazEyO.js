import{d as e,o as a,c as t,a as l,r as n,i as s,j as o,l as r,u as i,h as d,g as p,X as u,a4 as c,au as b,m,ac as g,z as f,w as v,v as h,av as y,aw as w,k as x,p as D,I as P,Z as k,a6 as _}from"./chunk-Bpe8Il_K.js";import{_ as T}from"./chunk-BQiP0DY8.js";import{i as C,u as A,b as O,l as R,d as z}from"./chunk-DpwHy-20.js";import{_ as L}from"./chunk-CdEVcDFJ.js";import{r as N,a as j}from"./chunk-DsM932Ci.js";const W={class:"drawer drawer-end h-0 w-0"},S={class:"drawer-content w-0 h-0 absolute"},F={class:"drawer-side"},U={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},V=e({__name:"index",setup(e,{expose:r}){const i=o(null),d=o(!1);return r({showDrawer:function(){i.value?.click(),d.value=!0},closeDrawer:function(){i.value?.click(),d.value=!1}}),(e,o)=>(a(),t("div",W,[o[1]||(o[1]=l("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),l("div",S,[l("label",{ref_key:"drawerTriggerRef",ref:i,for:"my-drawer-1"},null,512)]),l("div",F,[o[0]||(o[0]=l("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),d.value?(a(),t("div",U,[n(e.$slots,"content")])):s("",!0)])]))}}),$={class:"fieldset"},E={class:"label"},I=["placeholder"],q={class:"fieldset"},J={class:"label",required:""},M=["placeholder"],X={class:"validator-hint hidden"},Y={class:"fieldset"},Z={class:"label"},B=["placeholder"],G={class:"fieldset"},H={class:"label"},K=["placeholder"],Q={class:"fieldset"},ee={class:"label"},ae=["placeholder"],te={class:"btn btn-neutral mt-4",type:"submit"},le=e({__name:"SinglePerson",props:m({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(e){const{t:n}=r(),s=i(e,"singlePersonData");return(o,r)=>(a(),t("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:r[6]||(r[6]=a=>e.addOnePerson(e.addOnePersonDrawerRef,a))},[l("label",$,[l("span",E,d(p(n)("table.number")),1),u(l("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>s.value.uid=e),type:"text",class:"input validator",placeholder:p(n)("table.number")},null,8,I),[[c,s.value.uid]])]),l("fieldset",q,[l("label",J,[b(d(p(n)("table.name")),1),r[7]||(r[7]=l("span",{class:"text-red-500"},"*",-1))]),u(l("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>s.value.name=e),type:"text",class:"input validator",placeholder:p(n)("table.name"),required:"",minlength:"1"},null,8,M),[[c,s.value.name]]),l("p",X,d(p(n)("error.personNameEmpty")),1)]),l("label",Y,[l("span",Z,d(p(n)("table.department")),1),u(l("input",{"onUpdate:modelValue":r[2]||(r[2]=e=>s.value.department=e),type:"text",class:"input validator",placeholder:p(n)("table.department")},null,8,B),[[c,s.value.department]])]),l("label",G,[l("span",H,d(p(n)("table.avatar")),1),u(l("input",{"onUpdate:modelValue":r[3]||(r[3]=e=>s.value.avatar=e),type:"text",class:"input validator",placeholder:p(n)("table.avatar")},null,8,K),[[c,s.value.avatar]])]),l("label",Q,[l("span",ee,d(p(n)("table.identity")),1),u(l("input",{"onUpdate:modelValue":r[4]||(r[4]=e=>s.value.identity=e),type:"text",class:"input validator",placeholder:p(n)("table.identity")},null,8,ae),[[c,s.value.identity]])]),l("button",te,d(p(n)("button.confirm")),1),l("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:r[5]||(r[5]=a=>e.addOnePersonDrawerRef.closeDrawer())},d(p(n)("button.cancel")),1)],32))}});function ne(e){return new Worker("/log-lottery/assets/importExcel.worker-CWYp5aq3.js",{name:e?.name})}function se({exportInputFileRef:e}){const{t:a}=r(),t="/log-lottery/".replace("./","/"),l=g.useToast(),n=new ne,s=x(R),i=A().personConfig,{getAllPersonList:d,getAlreadyPersonList:p}=f(i),u=(c={handleDeletePerson:function(e){i.deletePerson(e)}},[{label:C.global.t("data.number"),props:"uid"},{label:C.global.t("data.name"),props:"name"},{label:C.global.t("data.department"),props:"department"},{label:C.global.t("data.avatar"),props:"avatar",formatValue:e=>e.avatar?`<img src="${e.avatar}" alt="avatar" style="width: 50px; height: 50px;"/>`:"-"},{label:C.global.t("data.identity"),props:"identity"},{label:C.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?C.global.t("data.yes"):C.global.t("data.no")},{label:C.global.t("data.operation"),actions:[{label:C.global.t("data.delete"),type:"btn-error",onClick:e=>{c.handleDeletePerson(e)}}]}]);var c;const b=o(!1),m=o({uid:"",name:"",department:"",avatar:"",identity:""});async function D(){if("zhCn"===C.global.locale.value){return await j(`${t}人口登记表-zhCn.xlsx`)}return await j(`${t}personListTemplate-en.xlsx`)}async function P(e){var a;s?.show(),D(),a={type:"start",data:e,templateData:await D()},n&&n.postMessage(a)}return{resetData:function(){i.resetAlreadyPerson()},deleteAll:function(){i.deleteAllPerson()},handleFileChange:async function(t){n&&(n.onmessage=t=>{if("done"===t.data.type&&(i.resetPerson(),i.addNotPersonList(t.data.data),l.open({message:a("error.importSuccess"),type:"success",position:"top-right"}),e.value&&(e.value.value="")),"error"===t.data.type){if("not right template"===t.data.message)return void l.open({message:a("error.excelFileError"),type:"error",position:"top-right"});l.open({message:t.data.message||a("error.importFail"),type:"error",position:"top-right"})}s?.hide()}),P(await N(t.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(d.value));for(let a=0;a<e.length;a++)delete e[a].x,delete e[a].y,delete e[a].id,delete e[a].createTime,delete e[a].updateTime,delete e[a].prizeId,e[a].isWin?e[a].isWin=C.global.t("data.yes"):e[a].isWin=C.global.t("data.no"),e[a].prizeTime=e[a].prizeTime.join(","),e[a].prizeName=e[a].prizeName.join(",");let t=JSON.stringify(e);if(t=t.replaceAll(/uid/g,C.global.t("data.number")).replaceAll(/isWin/g,C.global.t("data.isWin")).replaceAll(/department/g,C.global.t("data.department")).replaceAll(/name/g,C.global.t("data.name")).replaceAll(/identity/g,C.global.t("data.identity")).replaceAll(/prizeName/g,C.global.t("data.prizeName")).replaceAll(/prizeTime/g,C.global.t("data.prizeTime")),e=JSON.parse(t),e.length>0){const t=y.json_to_sheet(e),n=y.book_new();y.book_append_sheet(n,t,"Sheet1"),w(n,"data.xlsx"),l.open({message:a("error.exportSuccess"),type:"success",position:"top-right"})}},alreadyPersonList:p,allPersonList:d,tableColumnList:u,addOnePerson:function(e,a){a.preventDefault();const t=O([v(m.value)]);t[0].id=h(),i.addOnePerson(t),e.closeDrawer(),m.value={}},addPersonModalVisible:b,singlePersonData:m,downloadTemplate:function(){const e=C.global.t("data.xlsxName");fetch(`${t}${e}`).then(e=>e.blob()).then(t=>{const n=window.URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=e,s.click(),l.open({message:a("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const oe={class:"min-w-1000px"},re={class:"flex gap-3"},ie=["data-tip"],de={class:""},pe={for:"explore"},ue=["data-tip"],ce={class:"btn btn-primary btn-sm"},be=e({__name:"index",setup(e){const n=o(),s=o(),i=o(),u=o(),{resetData:c,deleteAll:b,handleFileChange:m,exportData:g,addOnePerson:f,singlePersonData:v,alreadyPersonList:h,allPersonList:y,tableColumnList:w,downloadTemplate:x}=se({exportInputFileRef:i}),{t:C}=r();return(e,o)=>(a(),t(k,null,[D(z,{ref_key:"resetDataDialogRef",ref:n,title:p(C)("dialog.titleTip"),desc:p(C)("dialog.dialogResetWinner"),"submit-func":p(c)},null,8,["title","desc","submit-func"]),D(z,{ref_key:"delAllDataDialogRef",ref:s,title:p(C)("dialog.titleTip"),desc:p(C)("dialog.dialogDelAllPerson"),"submit-func":p(b)},null,8,["title","desc","submit-func"]),D(V,{ref_key:"addOnePersonDrawerRef",ref:u},{content:P(()=>[D(le,{"single-person-data":p(v),"onUpdate:singlePersonData":o[0]||(o[0]=e=>_(v)?v.value=e:null),"add-one-person-drawer-ref":u.value,"add-one-person":p(f)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),l("div",oe,[D(L,{title:p(C)("viewTitle.personManagement")},{buttons:P(()=>[l("div",re,[l("button",{class:"btn btn-error btn-sm",onClick:o[1]||(o[1]=e=>s.value.showDialog())},d(p(C)("button.allDelete")),1),l("div",{class:"tooltip tooltip-bottom","data-tip":p(C)("tooltip.downloadTemplateTip")},[l("button",{class:"no-underline btn btn-secondary btn-sm",onClick:o[2]||(o[2]=(...e)=>p(x)&&p(x)(...e))},d(p(C)("button.downloadTemplate")),1)],8,ie),l("div",de,[l("label",pe,[l("div",{class:"tooltip tooltip-bottom","data-tip":p(C)("tooltip.uploadExcelTip")},[l("input",{id:"explore",ref_key:"exportInputFileRef",ref:i,type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:o[3]||(o[3]=(...e)=>p(m)&&p(m)(...e))},null,544),l("span",ce,d(p(C)("button.importData")),1)],8,ue)])]),l("button",{class:"btn btn-error btn-sm",onClick:o[4]||(o[4]=e=>n.value.showDialog())},d(p(C)("button.resetData")),1),l("button",{class:"btn btn-accent btn-sm",onClick:o[5]||(o[5]=(...e)=>p(g)&&p(g)(...e))},d(p(C)("button.exportResult")),1),l("button",{class:"btn btn-neutral btn-sm",onClick:o[6]||(o[6]=e=>u.value.showDrawer())},d(p(C)("button.add")),1),l("div",null,[l("span",null,d(p(C)("table.luckyPeopleNumber"))+":",1),l("span",null,d(p(h).length),1),o[7]||(o[7]=l("span",null," / ",-1)),l("span",null,d(p(y).length),1)])])]),_:1},8,["title"]),D(T,{"table-columns":p(w),data:p(y)},null,8,["table-columns","data"])])],64))}});export{be as default};
