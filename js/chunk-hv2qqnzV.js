import{ac as e,G as a,f as s,j as t,d as l,s as n,bf as r,B as o,A as u,o as c,c as d,a as i,Z as m,_ as v,h as f,X as g,a4 as h,g as p,bg as y,K as b,a6 as x,b as w}from"./chunk-Bpe8Il_K.js";import{a as T}from"./chunk-C6dfrL5A.js";import{I as M}from"./chunk-DpwHy-20.js";function j(){const l=e.useToast(),n=a(),r=t(""),o=t(""),u=t([]),c=new M("userMsg",["userMsg"],1,["createTime"]),d=async()=>{c.getDataSortedByDateTime("userMsg","dateTime").then(e=>{u.value=e})};return s(()=>{(async()=>{r.value=n.query.userSignature})(),d()}),{sendMsg:function(e){const a={data:e,dateTime:(new Date).toLocaleString()};T(r.value,a).then(a=>{l.open({message:a.msg||"发送成功",type:"success",position:"top-right"}),c.setData("userMsg",{msg:e}),d(),o.value=""})},userInputMsg:o,userMsgArray:u}}const k={class:"flex flex-col justify-around py-4"},D={class:"chat chat-end"},I={class:"chat-header"},_={class:"text-xs opacity-50"},A={class:"chat-bubble break-all whitespace-normal"},K={class:"border-none rounded-2xl bg-base-200 mx-2 p-2 flex flex-col gap-3 items-center justify-center shadow-md mb-8 h-48"},S=["onKeydown"],B=l({__name:"index",setup(e){n.extend(r),n.locale("zh-cn");const a=t(),l=t(),T=t(),M=t(Date.now()),{sendMsg:B,userInputMsg:H,userMsgArray:R}=j();async function q(){B(H.value),a.value.blur(),l.value.scrollTop=l.value.scrollHeight}const z=w(()=>(M.value,R.value.map(e=>({...e,formattedTime:n(e.dateTime).fromNow()}))));return o(()=>R.value.length,()=>{l.value&&setTimeout(()=>{l.value.scrollTop=l.value.scrollHeight},0)},{immediate:!0}),s(()=>{T.value=setInterval(()=>{M.value=Date.now()},6e4)}),u(()=>{T.value&&clearInterval(T.value)}),(e,s)=>(c(),d("div",k,[s[1]||(s[1]=i("div",{class:"h-12 drop-shadow-md shadow-lg"},[i("h2",{class:"text-center text-lg font-bold"}," 发送弹幕 ")],-1)),i("div",{ref_key:"messageArrayRef",ref:l,class:"overflow-y-auto h-[calc(100vh-15rem)]"},[i("ul",null,[(c(!0),d(m,null,v(z.value,e=>(c(),d("li",{key:e.id,class:"mb-3"},[i("div",D,[i("div",I,[i("time",_,f(e.formattedTime),1)]),i("div",A,f(e.msg),1)])]))),128))])],512),i("div",K,[g(i("textarea",{ref_key:"textareaRef",ref:a,"onUpdate:modelValue":s[0]||(s[0]=e=>x(H)?H.value=e:null),class:"textarea w-full rounded-xl border-none bg-transparent focus:outline-none focus:ring-0",placeholder:"发送弹幕 | 只展示您发送过的弹幕",rows:"5",cols:"50",onKeydown:y(b(q,["prevent"]),["enter"])},null,40,S),[[h,p(H)]]),i("div",{class:"w-full flex justify-end"},[i("button",{class:"btn btn-primary w-24 mb-4",onClick:q}," 发送 ")])])]))}});export{B as default};
