#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# è¯»å– stdin ä¸­çš„æ‰€æœ‰å†…å®¹
while read local_ref local_sha remote_ref remote_sha; do
  # æ£€æŸ¥æ˜¯å¦æ˜¯ tag æ¨é€
  case "$remote_ref" in
    refs/tags/*)
      # æå– tag åç§°
      TAG="${remote_ref#refs/tags/}"
      
      # åªæ ¡éªŒä»¥ "v" å¼€å¤´çš„ tag
      if [[ $TAG == v* ]]; then
        echo "ğŸ·ï¸  æ£€æŸ¥æ¨é€çš„ tag: $TAG"
        node .husky/scripts/verifyTagVersion.js "$TAG"
      else
        echo "â„¹ï¸  éç‰ˆæœ¬ tag ($TAG)ï¼Œè·³è¿‡æ ¡éªŒ"
      fi
      ;;
    *)
  esac
done

# å¦‚æœ stdin ä¸ºç©ºï¼ˆæ²¡æœ‰æ¨é€ä»»ä½•å¼•ç”¨ï¼‰ï¼Œä¹Ÿæ£€æŸ¥æœ€æ–° tag
if [ -t 0 ]; then
  LATEST_TAG=$(git describe --tags --abbrev=0 2>/dev/null)
  if [ $? -eq 0 ]; then
    # åªæ ¡éªŒä»¥ "v" å¼€å¤´çš„ tag
    if [[ $LATEST_TAG == v* ]]; then
      echo "ğŸ·ï¸  æ£€æŸ¥æœ€æ–°çš„ tag: $LATEST_TAG"
      node .husky/scripts/verifyTagVersion.js "$LATEST_TAG"
    else
      echo "â„¹ï¸  æœ€æ–° tag ($LATEST_TAG) ä¸æ˜¯ç‰ˆæœ¬ tagï¼Œè·³è¿‡æ ¡éªŒ"
    fi
  else
    echo "âš ï¸  æ²¡æœ‰æ‰¾åˆ°ä»»ä½• tagï¼Œè·³è¿‡ç‰ˆæœ¬æ ¡éªŒ"
  fi
fi